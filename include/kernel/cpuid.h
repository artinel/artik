#ifndef __KERNEL_CPUID_H_
#define __KERNEL_CPUID_H_

#include <stdint.h>

/* Main CPUID leaves (EAX) 0x00000000 - 0x0000001F*/
#define CPUID_VENDOR			0x00000000
#define CPUID_MAX_BASIC_LEAF		CPUID_VENDOR
#define CPUID_PROC_INFO			0x00000001
#define CPUID_FEAT_BITS			CPUID_PROC_INFO
#define CPUID_CACHE			0x00000002
#define CPUID_TLB			CPUID_CACHE
#define CPUID_PROC_SERIAL		0x00000003
#define CPUID_CACHE_PARAM		0x00000004
#define CPUID_MONITOR_MWAIT		0x00000005
#define CPUID_THERMAL_POWER		0x00000006
#define CPUID_EXTENDED_FEATS		0x00000007
#define CPUID_DIRECT_CACHE_INFO		0x00000009
#define CPUID_PMU_FEATS			0x0000000A
#define CPUID_EXT_TOPO_ENUM		0x0000000B
#define CPUID_PROC_EXT_STATE_ENUM	0x0000000D
#define CPUID_QOS_MONITORING		0x0000000F
#define CPUID_QOS_ENFORCEMENT		0x00000010
#define CPUID_PROC_TRACE_ENUM		0x00000014
#define CPUID_TIME_STAMP_COUNTER	0x00000015
#define CPUID_CRYSTAL_CLOCK		CPUID_TIME_STAMP_COUNTER
#define CPUID_PROC_FREQ_INFO		0x00000016
#define CPUID_SOC_VENDOR_ATTR		0x00000017
#define CPUID_PLATFORM_CAPS		0x00000018
#define CPUID_NATIVE_MODEL_ID_ENUM	0x0000001A
#define CPUID_PCONFIG_INFO		0x0000001B
#define CPUID_LBR_FILTER		0x0000001C
#define CPUID_KEY_LOCKER_INFO		0x0000001D
#define CPUID_ENH_NATIVE_MODEL_ID_ENUM	0x0000001E
#define CPUID_V2_EXT_TOPO_ENUM		0x0000001F

/* Extended function leaves (EAX) 0x80000000 - 0x800000FF */
#define CPUID_MAX_EXT_LEAF		0x80000000
#define CPUID_EXT_PROC_INFO		0x80000001
#define CPUID_EXT_FEATS			CPUID_EXT_PROC_INFO
#define CPUID_PROC_BRAND_A		0x80000002
#define CPUID_PROC_BRAND_B		0x80000003
#define CPUID_PROC_BRANC_C		0x80000004
#define CPUID_L1_CACHE_TLB		0x80000005
#define CPUID_L2_CACHE_TLB		0x80000006
#define CPUID_ADVANCED_POWER		0x80000007
#define CPUID_VIRT_PHYS_ADDR_SIZE	0x80000008
#define CPUID_DIRECT_CACHE_ACCESS_INFO	0x80000009
#define CPUID_SVM_FEATS			0x8000000A
#define CPUID_EXT_APIC_FEATS		0x8000000E
#define CPUID_TLB_1G_PAGE		0x80000019
#define CPUID_PERF_OPTI			0x8000001A
#define CPUID_IBS_AMD			0x8000001B
#define CPUID_LWP_AMD			0x8000001C
#define CPUID_CACHE_PROPS_AMD		0x8000001D
#define CPUID_EXT_TOPO_AMD		0x8000001E
#define CPUID_SEV_AMD			0x8000001F
#define CPUID_QOS_AMD			0x80000020
#define CPUID_EXT_FEATS_2_AMD		0x80000021

/* Hypervisor leaves (EAX) 0x40000000 - 0x400000FF */
#define CPUID_HYPER_VENDOR_ID		0x40000000
#define CPUID_HYPER_SYSTEN_ID		0x40000001

struct cpuid_regs {
	uint32_t eax;
	uint32_t ebx;
	uint32_t ecx;
	uint32_t edx;
};

typedef struct cpuid_regs cpuid_regs_t;

void cpuid(uint32_t leaf, uint32_t subleaf, cpuid_regs_t *regs);

#endif
